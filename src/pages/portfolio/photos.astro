---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { readdir } from 'node:fs/promises';
import { extname, resolve } from 'node:path';

const photosDir = resolve(process.cwd(), 'public', 'media', 'photos');
const allowedExt = new Set(['.jpg', '.jpeg', '.png', '.webp', '.gif', '.avif']);

let photoFiles: string[] = [];
try {
	photoFiles = (await readdir(photosDir, { withFileTypes: true }))
		.filter((entry) => entry.isFile())
		.map((entry) => entry.name)
		.filter((name) => allowedExt.has(extname(name).toLowerCase()))
		.sort((a, b) => a.localeCompare(b, undefined, { numeric: true, sensitivity: 'base' }));
} catch {
	photoFiles = [];
}

const toCaption = (filename: string) =>
	filename
		.replace(/\.[^/.]+$/, '')
		.replace(/[-_]+/g, ' ')
		.trim();
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead
			title="Photo Index | ATXPIXEL.COM"
			description="Photo collection placeholder for ATXPIXEL.COM"
		/>
		<style>
			.photo-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
				gap: 0.9rem;
				padding: 0;
				list-style: none;
			}
			.photo-grid li {
				margin: 0;
			}
			.photo-grid figure {
				margin: 0;
				border: 1px solid rgba(255, 255, 255, 0.08);
				border-radius: 10px;
				overflow: hidden;
				background: rgba(10, 10, 10, 0.85);
			}
			.photo-grid img {
				display: block;
				width: 100%;
				height: 100%;
				aspect-ratio: 4 / 3;
				object-fit: cover;
				border-radius: 0;
			}
			.photo-grid figcaption {
				padding: 0.55rem 0.7rem;
				font-size: 0.78rem;
				color: rgb(var(--gray));
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<h1>Landscaping</h1>
			{
				photoFiles.length > 0 ? (
					<ul class="photo-grid">
						{
							photoFiles.map((name) => (
								<li>
									<figure>
										<img src={`/media/photos/${encodeURIComponent(name)}`} alt={toCaption(name)} loading="lazy" />
										<figcaption>{toCaption(name)}</figcaption>
									</figure>
								</li>
							))
						}
					</ul>
				) : (
					<p>
						No images found yet. Add image files to <code>public/media/photos</code> and refresh.
					</p>
				)
			}
		</main>
		<Footer />
	</body>
</html>
